@model StudentApplicationGuidance.ModelView.SelectCourseViewModel

@{
    ViewData["Title"] = "Select Course";
}

<h1 class="text-center my-4">Select Course</h1>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <form id="qualificationForm" method="post" class="p-4 border rounded bg-light shadow-sm">
                <div class="form-group mb-3">
                    <label for="university" class="form-label">Select University:</label>
                    <select class="form-control" id="university" name="university" onchange="loadCourses()">
                        <option value="">Select University</option>
                        @foreach (var university in Model.Universities)
                        {
                            <option value="@university">@university</option>
                        }
                    </select>
                </div>

                <div class="form-group mb-3">
                    <label for="courseName" class="form-label">Select Course:</label>
                    <select class="form-control" id="courseName" name="courseName">
                        <option value="">Select Course</option>
                    </select>
                </div>

                <div class="text-center">
                    <button type="button" class="btn btn-primary btn-block" onclick="checkQualification()">Check Qualification</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function loadCourses() {
            var university = document.getElementById("university").value;
            var courseDropdown = document.getElementById("courseName");

            // Clear existing options
            courseDropdown.innerHTML = '<option value="">Select Course</option>';

            if (university) {
                fetch(`/Courses/GetCoursesByUniversity?university=${university}`)
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(course => {
                            var option = document.createElement("option");
                            option.value = course;
                            option.text = course;
                            courseDropdown.appendChild(option);
                        });
                    })
                    .catch(error => console.error('Error fetching courses:', error));
            }
        }

        function checkQualification() {
            var form = document.getElementById('qualificationForm');
            var formData = new FormData(form);

            fetch('/Courses/CheckQualification', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Success: ' + data.message);
                    } else {
                        alert('Error: ' + data.message);
                    }
                })
                .catch(error => console.error('Error checking qualification:', error));
        }
    </script>
}
